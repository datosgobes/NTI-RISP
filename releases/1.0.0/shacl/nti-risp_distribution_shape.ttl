@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix adms: <http://www.w3.org/ns/adms#> .
@prefix cc: <http://creativecommons.org/ns#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix org: <http://www.w3.org/ns/org#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix time: <http://www.w3.org/2006/time#> .
@prefix vcard: <http://www.w3.org/2006/vcard/ns#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcatap: <http://data.europa.eu/r5r/> .
@prefix ntirisp: <https://datosgobes.github.io/NTI-RISP/#> .

<https://datosgobes.github.io/NTI-RISP/releases/1.0.0/shacl/nti-risp_distribution_shape.ttl>
    rdf:type owl:Ontology ;
    rdfs:label "Restricciones para las distribuciones NTI-RISP (2013)"@es ;
    rdfs:label "Distributions restrictions for NTI-RISP (2013)"@en ;
    dcat:downloadURL <https://datosgobes.github.io/NTI-RISP/releases/1.0.0/shacl/shacl_distribution_shape.ttl> ;
    dct:format <http://publications.europa.eu/resource/authority/file-type/RDF_TURTLE> ;
    dct:conformsTo <https://www.w3.org/TR/shacl> ;
    dct:description "Este archivo incluye las restricciones SHACL para las propiedades y clases relacionadas con distribuciones en el perfil de aplicación NTI-RISP (2013)."@es ;
    dct:description "This file includes SHACL restrictions for properties and classes related to distributions in the NTI-RISP application profile (2013)."@en ;
    owl:versionInfo "1.0.0" ;
    dct:modified "2024-10-17"^^xsd:date ;
    dct:publisher <http://datos.gob.es/recurso/sector-publico/org/Organismo/E0DAT0001> ;
    cc:attributionURL <https://datos.gob.es/> ;
    dcatap:availability <http://data.europa.eu/r5r/stable> ;
    foaf:homepage <https://datosgobes.github.io/NTI-RISP/> ;
    rdfs:seeAlso <https://datosgobes.github.io/NTI-RISP/#Distribution> ;
    rdfs:comment """
        Este archivo requiere importar las siguientes dependencias adicionales para funcionar correctamente:
        - shacl_common_shapes.ttl
        - shacl_mdr-vocabularies.shape.ttl
        Asegúrese de que estén disponibles e importadas para una validación completa.
    """@es ;
    rdfs:comment """
        This file requires importing the following additional dependencies to work properly:
        - shacl_common_shapes.ttl
        - shacl_mdr-vocabularies.shape.ttl
        Make sure they are available and imported for full validation.
    """@en .

ntirisp:Distribution_Shape
    a sh:NodeShape ;
    sh:name "Distribution"@en ;
    sh:property 
    # dct:identifier (Recomendado, 0..1)
    [
        sh:path dct:identifier ;
        sh:minCount 1 ;
        sh:message "Se recomienda incluir un identificador URI para la distribución"@es ;
        sh:severity sh:Warning ;
    ],
    [
        sh:path dct:identifier ;
        sh:maxCount 1 ;
        sh:or (
            # Caso 1: Literal con valor URI
            [
                sh:nodeKind sh:Literal ;
                sh:pattern "^https?://.*$" ;
                sh:message "Si es un literal, debe tener forma de URL válida (http:// o https://)"@es ;
            ]
            # Caso 2: Referencia a un recurso URI
            [
                sh:nodeKind sh:IRI ;
                sh:pattern "^https?://.*$" ;
                sh:message "Si es un IRI, debe ser una URL válida (http:// o https://)"@es ;
            ]
        ) ;
        sh:message "El valor de dct:identifier debe ser un identificador URI válido, ya sea como literal o como referencia a recurso"@es ;
        sh:severity sh:Violation ;
    ],
    
    # dct:title (Recomendado, 0..n)
    [
        sh:path dct:title ;
        sh:minCount 1 ;
        sh:message "Se recomienda incluir un breve título o nombre para la distribución"@es ;
        sh:severity sh:Warning ;
    ],
    [
        sh:path dct:title ;
        sh:node ntirisp:MultilingualText_Shape ;
        sh:message "Cada título debe ser un literal con etiqueta de idioma válida"@es ;
        sh:severity sh:Warning ;
    ],
    
    
    # dcat:accessURL (Obligatorio, 1..1)
    [
        sh:path dcat:accessURL ;
        sh:minCount 1 ;
        sh:severity sh:Violation ;
        sh:message "La distribución debe contener al menos un dcat:accessURL."@es ;
    ],
    [
        sh:path dcat:accessURL ;
        sh:or (
            # Caso 1: IRI (referencia a recurso URI)
            [
                sh:nodeKind sh:IRI ;
                sh:message "El valor de dcat:accessURL puede ser un IRI válido"@es ;
            ]
            # Caso 2: Literal con datatype xsd:anyURI
            [
                sh:nodeKind sh:Literal ;
                sh:datatype xsd:anyURI ;
                sh:message "El valor de dcat:accessURL puede ser un literal con tipo xsd:anyURI"@es ;
            ]
        ) ;
        sh:message "El valor de dcat:accessURL debe ser un IRI o un literal xsd:anyURI válido"@es ;
        sh:severity sh:Violation ;
    ],
    
    # dct:format (Obligatorio, 1..1) - según modelo NTI-RISP usa dcat:mediaType
    [
        sh:path dct:format ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Se debe describir el formato en el que se encuentra representado el documento o recurso de información"@es ;
        sh:severity sh:Violation ;
    ],
    [
        sh:path dct:format ;
        sh:node ntirisp:MediaType_Shape ;
    ],
    
    # dcat:mediaType (Recomendado, 0..1) - compatibilidad DCAT
    [
        sh:path dcat:mediaType ;
        sh:minCount 1 ;
        sh:message "Se recomienda describir el tipo MIME del formato de los datos con la estructura: tipo/subtipo"@es ;
        sh:severity sh:Warning ;
    ],
    [
        sh:path dcat:mediaType ;
        sh:nodeKind sh:Literal ;
        sh:pattern "^[a-z0-9]+/[a-z0-9.+-]+$" ;
        sh:message "El tipo MIME debe seguir la estructura: tipo/subtipo"@es ;
        sh:severity sh:Violation ;
    ],
    
    # dcat:byteSize (Recomendado, 0..1)
    [
        sh:path dcat:byteSize ;
        sh:minCount 1 ;
        sh:message "Se recomienda describir el tamaño del recurso aproximado en bytes como un número entero no negativo (xsd:nonNegativeInteger)"@es ;
        sh:severity sh:Warning ;
    ],
    [
        sh:path dcat:byteSize ;
        sh:maxCount 1 ;
        sh:nodeKind sh:Literal ;
        sh:datatype xsd:nonNegativeInteger ;
        sh:message "dcat:byteSize debe ser descrito en bytes como un número entero no negativo (xsd:nonNegativeInteger)"@es ;
        sh:severity sh:Violation ;
    ],
    
    # dct:relation (Recomendado, 0..n)
    [
        sh:path dct:relation ;
        sh:minCount 1 ;
        sh:message "Se recomienda indicar una URI con una referencia a un recurso asociado con el formato"@es ;
        sh:severity sh:Warning ;
    ],
    [
        sh:path dct:relation ;
        sh:nodeKind sh:IRI ;
        sh:severity sh:Violation ;
    ];
    
    sh:targetClass dcat:Distribution .
